document.addEventListener("deviceready", onDeviceReady, false); let db; let carrito = []; function onDeviceReady() { // Recuperar carrito de localStorage carrito = JSON.parse(localStorage.getItem('carrito')) || []; // Abrir base de datos db = window.sqlitePlugin.openDatabase({ name: 'carmina.db', location: 'default' }); // Crear tablas y productos iniciales crearTablas(function () { insertarProductosIniciales(function () { mostrarProductos(); mostrarCarrito(); }); }); // Bot√≥n para hacer pedido document.getElementById("openWeb").addEventListener("click", function () { alert("Aqu√≠ ir√° el pedido üõí"); }); // Bot√≥n finalizar pedido const btnFinalizar = document.getElementById('finalizarPedido'); if (btnFinalizar) { btnFinalizar.addEventListener('click', function () { alert('Pedido enviado'); carrito = []; localStorage.setItem('carrito', JSON.stringify(carrito)); mostrarCarrito(); }); } } /* ---------- BASE DE DATOS ---------- */ function crearTablas(callback) { db.transaction(function (tx) { tx.executeSql( CREATE TABLE IF NOT EXISTS productos ( id INTEGER PRIMARY KEY AUTOINCREMENT, nombre TEXT, precio REAL, imagen TEXT ) ); tx.executeSql( CREATE TABLE IF NOT EXISTS carrito ( producto_id INTEGER, cantidad INTEGER ) ); }, function (error) { console.error("Error creando tablas", error); }, callback); } function insertarProductosIniciales(callback) { db.transaction(function (tx) { tx.executeSql('DELETE FROM productos'); // Evitar duplicados tx.executeSql('INSERT INTO productos (nombre, precio, imagen) VALUES (?,?,?)', ['Hortensia', 4, 'img/hortensia.jpg']); tx.executeSql('INSERT INTO productos (nombre, precio, imagen) VALUES (?,?,?)', ['Camelia', 2, 'img/camelia.jpg']); tx.executeSql('INSERT INTO productos (nombre, precio, imagen) VALUES (?,?,?)', ['Buganvilla', 5, 'img/buganvilla.jpg']); }, function (error) { console.error("Error insertando productos", error); }, callback); } /* ---------- MOSTRAR PRODUCTOS ---------- */ function mostrarProductos() { db.transaction(function (tx) { tx.executeSql('SELECT * FROM productos', [], function (tx, results) { let html = ''; for (let i = 0; i < results.rows.length; i++) { const p = results.rows.item(i); html += <div class="producto"> <img src="${p.imagen}"> <div> <h3>${p.nombre}</h3> <p>${p.precio} ‚Ç¨</p> </div> <button onclick="a√±adirAlCarrito(${p.id})">A√±adir</button> </div> ; } document.getElementById("listaProductos").innerHTML = html; }); }); } /* ---------- CARRITO ---------- */ function a√±adirAlCarrito(idProducto) { db.transaction(function (tx) { tx.executeSql('SELECT * FROM productos WHERE id = ?', [idProducto], function (tx, result) { const producto = result.rows.item(0); let existente = carrito.find(p => p.id === producto.id); if (existente) { existente.cantidad += 1; } else { carrito.push({ id: producto.id, nombre: producto.nombre, precio: producto.precio, cantidad: 1 }); } localStorage.setItem('carrito', JSON.stringify(carrito)); mostrarCarrito(); alert('Producto a√±adido al carrito'); }); }); } function mostrarCarrito() { let html = ''; let totalCarrito = 0; carrito.forEach(p => { html += <div>${p.nombre} - ${p.precio} ‚Ç¨ (x${p.cantidad})</div>; totalCarrito += p.precio * p.cantidad; }); document.getElementById("carrito").innerHTML = html; const totalElem = document.getElementById("totalResumen"); if (totalElem) totalElem.innerText = 'Total: ' + totalCarrito + ' ‚Ç¨'; }